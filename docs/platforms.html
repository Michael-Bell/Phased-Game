<!DOCTYPE html>

<html>
<head>
  <title>platforms.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="bullet.html">
                bullet.js
              </a>
            
              
              <a class="source" href="camera.html">
                camera.js
              </a>
            
              
              <a class="source" href="collision.html">
                collision.js
              </a>
            
              
              <a class="source" href="database.html">
                database.js
              </a>
            
              
              <a class="source" href="drops.html">
                drops.js
              </a>
            
              
              <a class="source" href="enemy.html">
                enemy.js
              </a>
            
              
              <a class="source" href="experience.html">
                experience.js
              </a>
            
              
              <a class="source" href="hearts.html">
                hearts.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="maptest.html">
                maptest.js
              </a>
            
              
              <a class="source" href="platforms.html">
                platforms.js
              </a>
            
              
              <a class="source" href="player.html">
                player.js
              </a>
            
              
              <a class="source" href="rain.html">
                rain.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>platforms.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> layer;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CreatePlatform</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Add the platforms</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-comment">/* TODO Just make a map in Tiled or something and import it in with tileset or something, be way easier */</span>
	<span class="hljs-comment">/* TODO Moving Platforms... */</span>
	ground = game.add.group(); <span class="hljs-comment">// using a group</span>
	ground.enableBody = <span class="hljs-literal">true</span>;

	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
		<span class="hljs-keyword">var</span> block = ground.create((<span class="hljs-number">5</span> * <span class="hljs-number">70</span>) + i * <span class="hljs-number">70</span>, <span class="hljs-number">600</span> - <span class="hljs-number">400</span>, <span class="hljs-string">'ground'</span>); <span class="hljs-comment">// Dirty math hack to shift over blocks</span>
		block.body.immovable = <span class="hljs-literal">true</span>;

	}
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">125</span>; i++) {
		<span class="hljs-keyword">var</span> block = ground.create(+i * <span class="hljs-number">70</span>, <span class="hljs-number">800</span>, <span class="hljs-string">'ground'</span>); <span class="hljs-comment">// Dirty math hack to shift over blocks</span>
		block.body.immovable = <span class="hljs-literal">true</span>;

	}
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
		<span class="hljs-keyword">var</span> block = ground.create(i * <span class="hljs-number">70</span>, <span class="hljs-number">600</span> - <span class="hljs-number">250</span>, <span class="hljs-string">'ground'</span>);
		block.body.immovable = <span class="hljs-literal">true</span>;

	}

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tileGen</span><span class="hljs-params">()</span> {</span>
	map = game.add.tilemap(gameLevel.string);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p> The first parameter is the tileset name, as specified in the Tiled map editor (and in the tilemap json file)
 The second parameter maps this name to the Phaser.Cache key ‘tiles’
tileset = game.add.tileset(‘tiles’);
tileset.setCollisionRange(0, tileset.total - 1, true, true, true, true);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	map.addTilesetImage(<span class="hljs-string">'groundSprite'</span>, <span class="hljs-string">'tiles'</span>);
	map.addTilesetImage(<span class="hljs-string">'flysheet'</span>, <span class="hljs-string">'fly'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p> Creates a layer from the World1 layer in the map data.
 A Layer is effectively like a Phaser.Sprite, so is added to the display list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	map.setCollisionBetween(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>layer = game.add.tilemapLayer(0, 0, 640, 480, map.tiles, map, 0);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	layer = map.createLayer(<span class="hljs-string">'ground'</span>);
	flyLayer = map.createLayer(<span class="hljs-string">'flies'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p> And now we convert all of the Tiled objects with an ID of 34 into sprites within the coins group</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>  map.createFromObjects(‘flies’, 0, ‘fly’, 0, true, false, enemyGroup);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	map.createFromObjects(<span class="hljs-string">'enemy'</span>, <span class="hljs-number">10</span>, <span class="hljs-string">'fly'</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, enemyGroup);
	map.createFromObjects(<span class="hljs-string">'enemy'</span>, <span class="hljs-number">11</span>, <span class="hljs-string">'fly'</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, enemyGroup);
	map.createFromObjects(<span class="hljs-string">'enemy'</span>, <span class="hljs-number">12</span>, <span class="hljs-string">'fly'</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, enemyGroup);

	enemyGroup.callAll(<span class="hljs-string">'animations.add'</span>, <span class="hljs-string">'animations'</span>, <span class="hljs-string">'wings'</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], <span class="hljs-number">10</span>, <span class="hljs-literal">true</span>);
	enemyGroup.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Update alpha first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		item.dmg = <span class="hljs-number">1</span>;
        item.goldWorth = <span class="hljs-number">5</span>;
        item.xpWorth = <span class="hljs-number">0.5</span>;
	});

	coinBoxGroup = game.add.group();
	coinBoxGroup.enableBody = <span class="hljs-literal">true</span>;
	coinBoxGroup.physicsBodyType = Phaser.Physics.ARCADE;
	map.createFromObjects(<span class="hljs-string">'special'</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'coinBox'</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, coinBoxGroup);

	coinBoxGroup.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Update alpha first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		item.body.immovable = <span class="hljs-literal">true</span>;
	});

    endBlocks = game.add.group();
    endBlocks.enableBody = <span class="hljs-literal">true</span>;
    endBlocks.physicsBodyType = Phaser.Physics.ARCADE;
    map.createFromObjects(<span class="hljs-string">'special'</span>, <span class="hljs-number">9</span>, <span class="hljs-string">'endblock'</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, endBlocks);

    endBlocks.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Update alpha first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        item.body.immovable = <span class="hljs-literal">true</span>;
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p> And play them</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
	enemyGroup.callAll(<span class="hljs-string">'animations.play'</span>, <span class="hljs-string">'animations'</span>, <span class="hljs-string">'wings'</span>);


    bounceBlock = game.add.group();

    bounceBlock.enableBody = <span class="hljs-literal">true</span>;

    bounceBlock.physicsBodyType = Phaser.Physics.ARCADE;

    map.createFromObjects(<span class="hljs-string">'special'</span>, <span class="hljs-number">6</span>, <span class="hljs-string">'endblock'</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, bounceBlock);


    bounceBlock.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Update alpha first.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        item.body.immovable = <span class="hljs-literal">true</span>;

    });</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>  map.createFromObjects(‘flies’, 2, ‘fly’, 0, true, false, enemyGroup);</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>map.createFromObjects(‘flies’, 3, ‘fly’, 0, true, false, enemyGroup);</p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p> This resizes the game world to match the layer dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	layer.resizeWorld();
}

<span class="hljs-keyword">var</span> asdf;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">collideCoinbox</span><span class="hljs-params">(player, block)</span> {</span>
	asdf = block;
	<span class="hljs-keyword">if</span> (block.body.touching.down) {
		block.kill();
		gencoins(block.x, block.y, <span class="hljs-number">1</span>);
		gencoins(block.x, block.y,<span class="hljs-number">1</span>);
		gencoins(block.x, block.y,<span class="hljs-number">1</span>);
		gencoins(block.x, block.y,<span class="hljs-number">1</span>);
		gencoins(block.x, block.y,<span class="hljs-number">1</span>);
		gencoins(block.x, block.y,<span class="hljs-number">1</span>);
		gencoins(block.x, block.y,<span class="hljs-number">1</span>);
		gencoins(block.x, block.y,<span class="hljs-number">1</span>);
		gencoins(block.x, block.y,<span class="hljs-number">1</span>);
	}

}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
