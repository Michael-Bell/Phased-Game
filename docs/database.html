<!DOCTYPE html>

<html>
<head>
  <title>database.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="bullet.html">
                bullet.js
              </a>
            
              
              <a class="source" href="camera.html">
                camera.js
              </a>
            
              
              <a class="source" href="collision.html">
                collision.js
              </a>
            
              
              <a class="source" href="database.html">
                database.js
              </a>
            
              
              <a class="source" href="drops.html">
                drops.js
              </a>
            
              
              <a class="source" href="enemy.html">
                enemy.js
              </a>
            
              
              <a class="source" href="experience.html">
                experience.js
              </a>
            
              
              <a class="source" href="hearts.html">
                hearts.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="maptest.html">
                maptest.js
              </a>
            
              
              <a class="source" href="platforms.html">
                platforms.js
              </a>
            
              
              <a class="source" href="player.html">
                player.js
              </a>
            
              
              <a class="source" href="rain.html">
                rain.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>database.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> PouchDB(<span class="hljs-string">'phase'</span>);
<span class="hljs-keyword">var</span> high = [{
		name : <span class="hljs-string">"null"</span>,
		score : <span class="hljs-number">0</span>
	}
];

db.info(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err, info)</span> {</span>
    db.changes({
        since : info.update_seq,
        live : <span class="hljs-literal">true</span>,
        onChange : showScores
    });
});


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addScore</span><span class="hljs-params">(text, score)</span> {</span>
    console.log(<span class="hljs-string">'addtodo'</span>);
	<span class="hljs-keyword">var</span> todo = {
		_id : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString(),
		name : text,
		score : score
	};
	db.put(todo, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span><span class="hljs-params">(err, result)</span> {</span>
		<span class="hljs-keyword">if</span> (!err) {
			console.log(<span class="hljs-string">'saved a score'</span>);
		}
		console.log(err + result);
	});
}

$(<span class="hljs-string">'#submit'</span>).on(<span class="hljs-string">'click'</span>, Foundation.utils.debounce(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
    <span class="hljs-keyword">if</span> (!$(<span class="hljs-string">'#submit'</span>).hasClass(<span class="hljs-string">'disabled'</span>)) {
        $(<span class="hljs-string">'#submit'</span>).addClass(<span class="hljs-string">'disabled'</span>);
console.log(!$(<span class="hljs-string">'#submit'</span>).hasClass(<span class="hljs-string">'disabled'</span>));
        name = $(<span class="hljs-string">'#name'</span>).val();
        addScore(name, score);
        console.log(<span class="hljs-string">'submit'</span>);
    }
	}, <span class="hljs-number">300</span>, <span class="hljs-literal">true</span>));


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showScores</span><span class="hljs-params">()</span> {</span>
	db.allDocs({
		include_docs : <span class="hljs-literal">true</span>,
		descending : <span class="hljs-literal">true</span>
	}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(err, doc)</span> {</span>
		refreshTables(doc.rows);
	});

    console.log(<span class="hljs-string">'showtodos'</span>);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshTables</span><span class="hljs-params">(todos)</span> {</span>
	high = [{name:<span class="hljs-string">'null'</span>,score:<span class="hljs-number">0</span>},{name:<span class="hljs-string">'null'</span>,score:<span class="hljs-number">0</span>},{name:<span class="hljs-string">'null'</span>,score:<span class="hljs-number">0</span>},{name:<span class="hljs-string">'null'</span>,score:<span class="hljs-number">0</span>},{name:<span class="hljs-string">'null'</span>,score:<span class="hljs-number">0</span>},{name:<span class="hljs-string">'null'</span>,score:<span class="hljs-number">0</span>},{name:<span class="hljs-string">'null'</span>,score:<span class="hljs-number">0</span>}];

	ul.innerHTML = <span class="hljs-string">""</span>;
	temp = <span class="hljs-number">0</span>;
	todos.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(todo)</span> {</span>
		createScoreItem(todo.doc, temp);
	});
    sortHighscores();
}

<span class="hljs-keyword">var</span> temp;
<span class="hljs-keyword">var</span> ul = document.getElementById(<span class="hljs-string">'todo-list'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createScoreItem</span><span class="hljs-params">(todo)</span> {</span>

	high[high.length] = {
		score : <span class="hljs-built_in">parseInt</span>(todo.score),
		name : todo.name
	};

	<span class="hljs-keyword">if</span> (temp &lt; <span class="hljs-number">5</span>) {
		<span class="hljs-keyword">var</span> name = document.createElement(<span class="hljs-string">'td'</span>);
		name.appendChild(document.createTextNode(todo.name));
		<span class="hljs-keyword">var</span> score = document.createElement(<span class="hljs-string">'td'</span>);
		score.appendChild(document.createTextNode(todo.score));
		<span class="hljs-keyword">var</span> divDisplay = document.createElement(<span class="hljs-string">'tr'</span>);
		divDisplay.className = <span class="hljs-string">'view'</span>;
		divDisplay.appendChild(name);
		divDisplay.appendChild(score);
		<span class="hljs-keyword">var</span> li = document.createElement(<span class="hljs-string">'tr'</span>);
		li.id = <span class="hljs-string">'li_'</span> + todo._id;
		li.appendChild(divDisplay);
		ul.appendChild(divDisplay);
		temp++;
	}

}

<span class="hljs-keyword">var</span> s;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sortHighscores</span><span class="hljs-params">()</span> {</span>
	sort = high.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(a, b)</span> {</span>
		<span class="hljs-keyword">return</span> b.score - a.score
	});
	<span class="hljs-keyword">var</span> a = document.getElementById(<span class="hljs-string">'highscores'</span>);
	a.innerHTML = <span class="hljs-string">""</span>;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p> s += high[i][0] + ‘,’ + high[i][1] + ‘\n’;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">var</span> name = document.createElement(<span class="hljs-string">'td'</span>);
		name.appendChild(document.createTextNode(sort[i].name));
		<span class="hljs-keyword">var</span> score = document.createElement(<span class="hljs-string">'td'</span>);
		score.appendChild(document.createTextNode(sort[i].score));
		<span class="hljs-keyword">var</span> divDisplay = document.createElement(<span class="hljs-string">'tr'</span>);
		divDisplay.className = <span class="hljs-string">'view'</span>;
		divDisplay.appendChild(name);
		divDisplay.appendChild(score);
		a.appendChild(divDisplay);
	}

}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
